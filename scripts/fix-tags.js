const fs = require('fs');
const path = require('path');

console.log('ğŸ”§ äº”å±‚é¡µé¢æ ‡ç­¾è‡ªåŠ¨ä¿®å¤ç³»ç»Ÿ\n');

class TagFixer {
  constructor() {
    this.fixedFiles = [];
    this.errors = [];
    this.stats = {
      totalFiles: 0,
      fixedFiles: 0,
      errorFiles: 0
    };
    
    // åœ°åŒºæ ‡ç­¾æ˜ å°„
    this.regionMapping = {
      'tokyo': 'ä¸œäº¬',
      'saitama': 'åŸ¼ç‰', 
      'chiba': 'åƒå¶',
      'kanagawa': 'ç¥å¥ˆå·',
      'kitakanto': 'åŒ—å…³ä¸œ',
      'koshinetsu': 'ç”²ä¿¡è¶Š'
    };
    
    // æœˆä»½æ ‡ç­¾æ˜ å°„
    this.monthMapping = {
      'july': '7æœˆ',
      'august': '8æœˆ', 
      'september': '9æœˆ'
    };
    
    // éœ€è¦ä¿®å¤çš„é”™è¯¯åœ°åŒºåç§°æ˜ å°„
    this.regionFixMapping = {
      'ä¸œäº¬éƒ½': 'ä¸œäº¬',
      'åŸ¼ç‰å¿': 'åŸ¼ç‰',
      'åƒå¶å¿': 'åƒå¶',
      'ç¥å¥ˆå·å¿': 'ç¥å¥ˆå·',
      'èŒ¨åŸå¿': 'åŒ—å…³ä¸œ',
      'ç¾¤é©¬å¿': 'åŒ—å…³ä¸œ',
      'æ ƒæœ¨å¿': 'åŒ—å…³ä¸œ',
      'æ–°æ½Ÿå¿': 'ç”²ä¿¡è¶Š',
      'é•¿é‡å¿': 'ç”²ä¿¡è¶Š',
      'å±±æ¢¨å¿': 'ç”²ä¿¡è¶Š',
      'èŒ¨åŸçœŒ': 'åŒ—å…³ä¸œ',
      'ç¾¤é¦¬çœŒ': 'åŒ—å…³ä¸œ',
      'æ ƒæœ¨çœŒ': 'åŒ—å…³ä¸œ'
    };
    
    // åŸºäºåœ°åçš„åœ°åŒºæ¨æ–­
    this.locationToRegion = {
      // ä¸œäº¬
      'ä¸œäº¬': 'ä¸œäº¬', 'æ–°å®¿': 'ä¸œäº¬', 'æ¶©è°·': 'ä¸œäº¬', 'æ± è¢‹': 'ä¸œäº¬', 'é“¶åº§': 'ä¸œäº¬',
      'ç§‹å¶åŸ': 'ä¸œäº¬', 'æµ…è‰': 'ä¸œäº¬', 'ä¸Šé‡': 'ä¸œäº¬', 'å“å·': 'ä¸œäº¬', 'ç«‹å·': 'ä¸œäº¬',
      'å…«ç‹å­': 'ä¸œäº¬', 'è°ƒå¸ƒ': 'ä¸œäº¬', 'ä¸‰é¹°': 'ä¸œäº¬', 'æ­¦è”µé‡': 'ä¸œäº¬', 'åºœä¸­': 'ä¸œäº¬',
      'æ˜­å²›': 'ä¸œäº¬', 'ç”ºç”°': 'ä¸œäº¬', 'å°å¹³': 'ä¸œäº¬', 'æ—¥é‡': 'ä¸œäº¬', 'ä¸œæ‘å±±': 'ä¸œäº¬',
      'å›½åˆ†å¯º': 'ä¸œäº¬', 'å›½ç«‹': 'ä¸œäº¬', 'ç¦ç”Ÿ': 'ä¸œäº¬', 'ç‹›æ±Ÿ': 'ä¸œäº¬', 'ä¸œå¤§å’Œ': 'ä¸œäº¬',
      'æ¸…ç€¬': 'ä¸œäº¬', 'ä¸œä¹…ç•™ç±³': 'ä¸œäº¬', 'æ­¦è”µæ‘å±±': 'ä¸œäº¬', 'å¤šæ‘©': 'ä¸œäº¬', 'ç¨»åŸ': 'ä¸œäº¬',
      'ç¾½æ‘': 'ä¸œäº¬', 'é’æ¢…': 'ä¸œäº¬', 'è¥¿ä¸œäº¬': 'ä¸œäº¬', 'ç‘ç©—': 'ä¸œäº¬', 'æ—¥ä¹‹å‡º': 'ä¸œäº¬',
      'æªœåŸ': 'ä¸œäº¬', 'å¥¥å¤šæ‘©': 'ä¸œäº¬', 'å¤§å²›': 'ä¸œäº¬', 'åˆ©å²›': 'ä¸œäº¬', 'æ–°å²›': 'ä¸œäº¬',
      'ç¥æ´¥å²›': 'ä¸œäº¬', 'ä¸‰å®…å²›': 'ä¸œäº¬', 'å¾¡è”µå²›': 'ä¸œäº¬', 'å…«ä¸ˆå²›': 'ä¸œäº¬', 'é’å²›': 'ä¸œäº¬',
      'å°ç¬ åŸ': 'ä¸œäº¬', 'ç¥å®«å¤–è‹‘': 'ä¸œäº¬', 'è‘›é¥°': 'ä¸œäº¬', 'æ±Ÿæˆ·å·': 'ä¸œäº¬', 'æ¿æ¡¥': 'ä¸œäº¬',
      'ç¥æ´¥': 'ä¸œäº¬', 'å°æ´¥': 'ä¸œäº¬',
      
      // åŸ¼ç‰
      'åŸ¼ç‰': 'åŸ¼ç‰', 'æµ¦å’Œ': 'åŸ¼ç‰', 'å¤§å®«': 'åŸ¼ç‰', 'å·å£': 'åŸ¼ç‰', 'å·è¶Š': 'åŸ¼ç‰',
      'æ‰€æ²¢': 'åŸ¼ç‰', 'æ˜¥æ—¥éƒ¨': 'åŸ¼ç‰', 'ç‹­å±±': 'åŸ¼ç‰', 'ä¸Šå°¾': 'åŸ¼ç‰', 'è‰åŠ ': 'åŸ¼ç‰',
      'è¶Šè°·': 'åŸ¼ç‰', 'è•¨': 'åŸ¼ç‰', 'æˆ¸ç”°': 'åŸ¼ç‰', 'å…¥é—´': 'åŸ¼ç‰', 'æœéœ': 'åŸ¼ç‰',
      'å¿—æœ¨': 'åŸ¼ç‰', 'å’Œå…‰': 'åŸ¼ç‰', 'æ–°åº§': 'åŸ¼ç‰', 'æ¡¶å·': 'åŸ¼ç‰', 'ä¹…å–œ': 'åŸ¼ç‰',
      'åŒ—æœ¬': 'åŸ¼ç‰', 'å…«æ½®': 'åŸ¼ç‰', 'å¯Œå£«è§': 'åŸ¼ç‰', 'ä¸‰éƒ·': 'åŸ¼ç‰', 'è²ç”°': 'åŸ¼ç‰',
      'å‚æˆ¸': 'åŸ¼ç‰', 'å¹¸æ‰‹': 'åŸ¼ç‰', 'é¹¤å²›': 'åŸ¼ç‰', 'æ—¥é«˜': 'åŸ¼ç‰', 'å‰å·': 'åŸ¼ç‰',
      'ç™½å†ˆ': 'åŸ¼ç‰', 'ä¼Šå¥ˆ': 'åŸ¼ç‰', 'ä¸‰èŠ³': 'åŸ¼ç‰', 'æ¯›å•å±±': 'åŸ¼ç‰', 'è¶Šç”Ÿ': 'åŸ¼ç‰',
      'æ»‘å·': 'åŸ¼ç‰', 'åµå±±': 'åŸ¼ç‰', 'å°å·': 'åŸ¼ç‰', 'å·å²›': 'åŸ¼ç‰', 'å‰è§': 'åŸ¼ç‰',
      'é¸ å±±': 'åŸ¼ç‰', 'ä¸œæ¾å±±': 'åŸ¼ç‰', 'ç†Šè°·': 'åŸ¼ç‰', 'è¡Œç”°': 'åŸ¼ç‰', 'ç§©çˆ¶': 'åŸ¼ç‰',
      'é£¯èƒ½': 'åŸ¼ç‰', 'åŠ é¡»': 'åŸ¼ç‰', 'æœ¬åº„': 'åŸ¼ç‰', 'ç¾½ç”Ÿ': 'åŸ¼ç‰', 'é¸¿å·¢': 'åŸ¼ç‰',
      'æ·±è°·': 'åŸ¼ç‰', 'ä¸Šé‡Œ': 'åŸ¼ç‰', 'ç¾é‡Œ': 'åŸ¼ç‰', 'ç¥å·': 'åŸ¼ç‰', 'ä¸Šé‡': 'åŸ¼ç‰',
      'å¯„å±…': 'åŸ¼ç‰', 'å®«ä»£': 'åŸ¼ç‰', 'æ‰æˆ¸': 'åŸ¼ç‰', 'æ¾ä¼': 'åŸ¼ç‰', 'å²©æ§»': 'åŸ¼ç‰',
      'å¤§éº»ç”Ÿ': 'åŸ¼ç‰', 'è¥¿æ­¦å›­': 'åŸ¼ç‰', 'æ¢…å…¹å¡”': 'åŸ¼ç‰', 'é£¯èƒ½': 'åŸ¼ç‰',
      
      // åƒå¶
      'åƒå¶': 'åƒå¶', 'å¸‚å·': 'åƒå¶', 'èˆ¹æ©‹': 'åƒå¶', 'æ¾æˆ¸': 'åƒå¶', 'é‡ç”°': 'åƒå¶',
      'èŒ‚åŸ': 'åƒå¶', 'æˆç”°': 'åƒå¶', 'ä½å€‰': 'åƒå¶', 'ä¸œé‡‘': 'åƒå¶', 'æ—­': 'åƒå¶',
      'ä¹ å¿—é‡': 'åƒå¶', 'æŸ': 'åƒå¶', 'å‹æµ¦': 'åƒå¶', 'å¸‚åŸ': 'åƒå¶', 'æµå±±': 'åƒå¶',
      'å…«åƒä»£': 'åƒå¶', 'æˆ‘å­™å­': 'åƒå¶', 'é¸­å·': 'åƒå¶', 'é•°è°·': 'åƒå¶', 'å›æ´¥': 'åƒå¶',
      'å¯Œæ´¥': 'åƒå¶', 'æµ¦å®‰': 'åƒå¶', 'å››è¡—é“': 'åƒå¶', 'è¢–æµ¦': 'åƒå¶', 'å…«è¡—': 'åƒå¶',
      'å°è¥¿': 'åƒå¶', 'ç™½äº•': 'åƒå¶', 'å¯Œé‡Œ': 'åƒå¶', 'å—æˆ¿æ€»': 'åƒå¶', 'åŒç‘³': 'åƒå¶',
      'é¦™å–': 'åƒå¶', 'å±±æ­¦': 'åƒå¶', 'å¤§ç½‘ç™½é‡Œ': 'åƒå¶', 'é…’ã€…äº•': 'åƒå¶', 'è£': 'åƒå¶',
      'ç¥å´': 'åƒå¶', 'å¤šå¤': 'åƒå¶', 'ä¸œåº„': 'åƒå¶', 'ä¹åä¹é‡Œ': 'åƒå¶', 'èŠå±±': 'åƒå¶',
      'æ¨ªèŠå…‰': 'åƒå¶', 'ä¸€å®«': 'åƒå¶', 'ç¦æ²¢': 'åƒå¶', 'é•¿ç”Ÿ': 'åƒå¶', 'ç™½å­': 'åƒå¶',
      'é•¿æŸ„': 'åƒå¶', 'é•¿å—': 'åƒå¶', 'å¤§å¤šå–œ': 'åƒå¶', 'å¾¡å®¿': 'åƒå¶', 'é‹¸å—': 'åƒå¶',
      'é“«å­': 'åƒå¶', 'æœ¨æ›´æ´¥': 'åƒå¶', 'å¹•å¼ ': 'åƒå¶', 'æˆä¸œ': 'åƒå¶', 'æ‰‹è´ºæ²¼': 'åƒå¶',
      'æ¯äº²ç‰§åœº': 'åƒå¶', 'ç™½æµœ': 'åƒå¶', 'å°è§å·': 'åƒå¶',
      
      // ç¥å¥ˆå·
      'ç¥å¥ˆå·': 'ç¥å¥ˆå·', 'æ¨ªæ»¨': 'ç¥å¥ˆå·', 'å·å´': 'ç¥å¥ˆå·', 'ç›¸æ¨¡åŸ': 'ç¥å¥ˆå·', 'æ¨ªé¡»è´º': 'ç¥å¥ˆå·',
      'å¹³å¡š': 'ç¥å¥ˆå·', 'é•°ä»“': 'ç¥å¥ˆå·', 'è—¤æ²½': 'ç¥å¥ˆå·', 'å°ç”°åŸ': 'ç¥å¥ˆå·', 'èŒ…å´': 'ç¥å¥ˆå·',
      'é€—å­': 'ç¥å¥ˆå·', 'ä¸‰æµ¦': 'ç¥å¥ˆå·', 'ç§¦é‡': 'ç¥å¥ˆå·', 'åšæœ¨': 'ç¥å¥ˆå·', 'å¤§å’Œ': 'ç¥å¥ˆå·',
      'ä¼ŠåŠ¿åŸ': 'ç¥å¥ˆå·', 'æµ·è€å': 'ç¥å¥ˆå·', 'åº§é—´': 'ç¥å¥ˆå·', 'å—è¶³æŸ„': 'ç¥å¥ˆå·', 'ç»«æ¿‘': 'ç¥å¥ˆå·',
      'å¶å±±': 'ç¥å¥ˆå·', 'å¯’å·': 'ç¥å¥ˆå·', 'å¤§çŸ¶': 'ç¥å¥ˆå·', 'äºŒå®«': 'ç¥å¥ˆå·', 'ä¸­äº•': 'ç¥å¥ˆå·',
      'å¤§äº•': 'ç¥å¥ˆå·', 'æ¾ç”°': 'ç¥å¥ˆå·', 'å±±åŒ—': 'ç¥å¥ˆå·', 'å¼€æˆ': 'ç¥å¥ˆå·', 'ç®±æ ¹': 'ç¥å¥ˆå·',
      'çœŸé¹¤': 'ç¥å¥ˆå·', 'æ¹¯æ²³åŸ': 'ç¥å¥ˆå·', 'çˆ±å·': 'ç¥å¥ˆå·', 'æ¸…å·': 'ç¥å¥ˆå·', 'ç›¸æ¨¡æ¹–': 'ç¥å¥ˆå·',
      'æ´¥ä¹…äº•': 'ç¥å¥ˆå·', 'ç›¸æ¨¡': 'ç¥å¥ˆå·', 'é…’åŒ‚å·': 'ç¥å¥ˆå·', 'ä¹…é‡Œæµœ': 'ç¥å¥ˆå·',
      'å…«æ™¯å²›': 'ç¥å¥ˆå·', 'èŒ…å´å—': 'ç¥å¥ˆå·',
      
      // åŒ—å…³ä¸œï¼ˆèŒ¨åŸã€æ ƒæœ¨ã€ç¾¤é©¬ï¼‰
      'æ°´æˆ¸': 'åŒ—å…³ä¸œ', 'æ—¥ç«‹': 'åŒ—å…³ä¸œ', 'åœŸæµ¦': 'åŒ—å…³ä¸œ', 'å¤æ²³': 'åŒ—å…³ä¸œ', 'çŸ³å†ˆ': 'åŒ—å…³ä¸œ',
      'ç»“åŸ': 'åŒ—å…³ä¸œ', 'é¾™å´': 'åŒ—å…³ä¸œ', 'ä¸‹å¦»': 'åŒ—å…³ä¸œ', 'å¸¸æ€»': 'åŒ—å…³ä¸œ', 'å¸¸é™†å¤ªç”°': 'åŒ—å…³ä¸œ',
      'é«˜è©': 'åŒ—å…³ä¸œ', 'åŒ—èŒ¨åŸ': 'åŒ—å…³ä¸œ', 'ç¬ é—´': 'åŒ—å…³ä¸œ', 'å–æ‰‹': 'åŒ—å…³ä¸œ', 'ç‰›ä¹…': 'åŒ—å…³ä¸œ',
      'ç­‘æ³¢': 'åŒ—å…³ä¸œ', 'æ—¥ç«‹é‚£ç‚': 'åŒ—å…³ä¸œ', 'é¹¿å¶‹': 'åŒ—å…³ä¸œ', 'æ½®æ¥': 'åŒ—å…³ä¸œ', 'å®ˆè°·': 'åŒ—å…³ä¸œ',
      'å¸¸é™†å¤§å®«': 'åŒ—å…³ä¸œ', 'é‚£ç‚': 'åŒ—å…³ä¸œ', 'ç­‘è¥¿': 'åŒ—å…³ä¸œ', 'å‚ä¸œ': 'åŒ—å…³ä¸œ', 'ç¨»æ•·': 'åŒ—å…³ä¸œ',
      'æ¡ç”°': 'åŒ—å…³ä¸œ', 'ç¥æ –': 'åŒ—å…³ä¸œ', 'è¡Œæ–¹': 'åŒ—å…³ä¸œ', 'é‰¾ç”°': 'åŒ—å…³ä¸œ', 'ç­‘æ³¢æœªæ¥': 'åŒ—å…³ä¸œ',
      'å®‡éƒ½å®«': 'åŒ—å…³ä¸œ', 'è¶³åˆ©': 'åŒ—å…³ä¸œ', 'æ ƒæœ¨': 'åŒ—å…³ä¸œ', 'ä½é‡': 'åŒ—å…³ä¸œ', 'é¹¿æ²¼': 'åŒ—å…³ä¸œ',
      'æ—¥å…‰': 'åŒ—å…³ä¸œ', 'å°å±±': 'åŒ—å…³ä¸œ', 'çœŸå†ˆ': 'åŒ—å…³ä¸œ', 'å¤§ç”°åŸ': 'åŒ—å…³ä¸œ', 'çŸ¢æ¿': 'åŒ—å…³ä¸œ',
      'é‚£é¡»å¡©åŸ': 'åŒ—å…³ä¸œ', 'æ¨±': 'åŒ—å…³ä¸œ', 'é‚£é¡»ä¹Œå±±': 'åŒ—å…³ä¸œ', 'ä¸‹é‡': 'åŒ—å…³ä¸œ',
      'å‰æ¡¥': 'åŒ—å…³ä¸œ', 'é«˜å´': 'åŒ—å…³ä¸œ', 'æ¡ç”Ÿ': 'åŒ—å…³ä¸œ', 'ä¼ŠåŠ¿å´': 'åŒ—å…³ä¸œ', 'å¤ªç”°': 'åŒ—å…³ä¸œ',
      'æ²¼ç”°': 'åŒ—å…³ä¸œ', 'é¦†æ—': 'åŒ—å…³ä¸œ', 'æ¸‹å·': 'åŒ—å…³ä¸œ', 'è—¤å†ˆ': 'åŒ—å…³ä¸œ', 'å¯Œå†ˆ': 'åŒ—å…³ä¸œ',
      'å®‰ä¸­': 'åŒ—å…³ä¸œ', 'ç»¿': 'åŒ—å…³ä¸œ', 'ç‰æ‘': 'åŒ—å…³ä¸œ', 'æ¿ä»“': 'åŒ—å…³ä¸œ', 'æ˜å’Œ': 'åŒ—å…³ä¸œ',
      'åƒä»£ç”°': 'åŒ—å…³ä¸œ', 'å¤§æ³‰': 'åŒ—å…³ä¸œ', 'é‚‘æ¥½': 'åŒ—å…³ä¸œ', 'èŒ¨åŸ': 'åŒ—å…³ä¸œ', 'æ ƒæœ¨': 'åŒ—å…³ä¸œ',
      'ç¾¤é©¬': 'åŒ—å…³ä¸œ', 'å¸¸é™†': 'åŒ—å…³ä¸œ', 'åˆ©æ ¹': 'åŒ—å…³ä¸œ', 'é¬¼æ€’å·': 'åŒ—å…³ä¸œ', 'å¤§æ´—': 'åŒ—å…³ä¸œ',
      'å¸¸æ€»': 'åŒ—å…³ä¸œ', 'å–æ‰‹': 'åŒ—å…³ä¸œ', 'é¾™æ¹–': 'åŒ—å…³ä¸œ',
      
      // ç”²ä¿¡è¶Šï¼ˆå±±æ¢¨ã€é•¿é‡ã€æ–°æ½Ÿï¼‰
      'ç”²åºœ': 'ç”²ä¿¡è¶Š', 'å¯Œå£«å‰ç”°': 'ç”²ä¿¡è¶Š', 'éƒ½ç•™': 'ç”²ä¿¡è¶Š', 'å±±æ¢¨': 'ç”²ä¿¡è¶Š', 'å¤§æœˆ': 'ç”²ä¿¡è¶Š',
      'éŸ­å´': 'ç”²ä¿¡è¶Š', 'å—é˜¿å°”å‘æ–¯': 'ç”²ä¿¡è¶Š', 'åŒ—æœ': 'ç”²ä¿¡è¶Š', 'ç”²æ–': 'ç”²ä¿¡è¶Š', 'ç¬›å¹': 'ç”²ä¿¡è¶Š',
      'ç”²å·': 'ç”²ä¿¡è¶Š', 'ä¸­å¤®': 'ç”²ä¿¡è¶Š', 'å¸‚å·ä¸‰éƒ·': 'ç”²ä¿¡è¶Š', 'æ—©å·': 'ç”²ä¿¡è¶Š', 'èº«å»¶': 'ç”²ä¿¡è¶Š',
      'å—éƒ¨': 'ç”²ä¿¡è¶Š', 'å¯Œå£«å·': 'ç”²ä¿¡è¶Š', 'æ˜­å’Œ': 'ç”²ä¿¡è¶Š', 'é“å¿—': 'ç”²ä¿¡è¶Š', 'è¥¿æ¡‚': 'ç”²ä¿¡è¶Š',
      'å¿é‡': 'ç”²ä¿¡è¶Š', 'å±±ä¸­æ¹–': 'ç”²ä¿¡è¶Š', 'é¸£æ²¢': 'ç”²ä¿¡è¶Š', 'å¯Œå£«æ²³å£æ¹–': 'ç”²ä¿¡è¶Š', 'å°è…': 'ç”²ä¿¡è¶Š',
      'ä¸¹æ³¢å±±': 'ç”²ä¿¡è¶Š', 'é•¿é‡': 'ç”²ä¿¡è¶Š', 'æ¾æœ¬': 'ç”²ä¿¡è¶Š', 'ä¸Šç”°': 'ç”²ä¿¡è¶Š', 'å†ˆè°·': 'ç”²ä¿¡è¶Š',
      'é£¯ç”°': 'ç”²ä¿¡è¶Š', 'è¯¹è®¿': 'ç”²ä¿¡è¶Š', 'é¡»å‚': 'ç”²ä¿¡è¶Š', 'å°è¯¸': 'ç”²ä¿¡è¶Š', 'ä¼Šé‚£': 'ç”²ä¿¡è¶Š',
      'é©¹æ ¹': 'ç”²ä¿¡è¶Š', 'ä¸­é‡': 'ç”²ä¿¡è¶Š', 'å¤§ç”º': 'ç”²ä¿¡è¶Š', 'é£¯å±±': 'ç”²ä¿¡è¶Š', 'èŒ…é‡': 'ç”²ä¿¡è¶Š',
      'å¡©å°»': 'ç”²ä¿¡è¶Š', 'ä½ä¹…': 'ç”²ä¿¡è¶Š', 'åƒæ›²': 'ç”²ä¿¡è¶Š', 'ä¸œå¾¡': 'ç”²ä¿¡è¶Š', 'å®‰äº‘é‡': 'ç”²ä¿¡è¶Š',
      'æ–°æ½Ÿ': 'ç”²ä¿¡è¶Š', 'é•¿å†ˆ': 'ç”²ä¿¡è¶Š', 'ä¸‰æ¡': 'ç”²ä¿¡è¶Š', 'æŸå´': 'ç”²ä¿¡è¶Š', 'æ–°å‘ç”°': 'ç”²ä¿¡è¶Š',
      'å°åƒè°·': 'ç”²ä¿¡è¶Š', 'åŠ èŒ‚': 'ç”²ä¿¡è¶Š', 'åæ—¥ç”º': 'ç”²ä¿¡è¶Š', 'è§é™„': 'ç”²ä¿¡è¶Š', 'æ‘ä¸Š': 'ç”²ä¿¡è¶Š',
      'ç‡•': 'ç”²ä¿¡è¶Š', 'ç³¸é±¼å·': 'ç”²ä¿¡è¶Š', 'å¦™é«˜': 'ç”²ä¿¡è¶Š', 'äº”æ³‰': 'ç”²ä¿¡è¶Š', 'ä¸Šè¶Š': 'ç”²ä¿¡è¶Š',
      'é˜¿è´ºé‡': 'ç”²ä¿¡è¶Š', 'ä½æ¸¡': 'ç”²ä¿¡è¶Š', 'é­šæ²¼': 'ç”²ä¿¡è¶Š', 'å—é­šæ²¼': 'ç”²ä¿¡è¶Š', 'èƒå†…': 'ç”²ä¿¡è¶Š',
      'æ²³å£æ¹–': 'ç”²ä¿¡è¶Š', 'å¯Œå£«å±±': 'ç”²ä¿¡è¶Š', 'çŸ³å’Œ': 'ç”²ä¿¡è¶Š', 'é‡å°»æ¹–': 'ç”²ä¿¡è¶Š', 'æœåŸ': 'ç”²ä¿¡è¶Š',
      'æ–°ä½œ': 'ç”²ä¿¡è¶Š', 'ç¥‡å›­': 'ç”²ä¿¡è¶Š', 'æŸå´': 'ç”²ä¿¡è¶Š', 'åŠ¨æ¼«': 'ç”²ä¿¡è¶Š'
    };
  }

  // ä»æ–‡ä»¶åæ¨æ–­æ­£ç¡®çš„åœ°åŒºå’Œæœˆä»½
  inferCorrectTags(filename) {
    let correctRegion = null;
    let correctMonth = null;
    
    // æ¨æ–­åœ°åŒº
    for (const [key, value] of Object.entries(this.regionMapping)) {
      if (filename.includes(key)) {
        correctRegion = value;
        break;
      }
    }
    
    // æ¨æ–­æœˆä»½
    for (const [key, value] of Object.entries(this.monthMapping)) {
      if (filename.includes(key)) {
        correctMonth = value;
        break;
      }
    }
    
    return { correctRegion, correctMonth };
  }

  // ä»æ–‡ä»¶å†…å®¹æ¨æ–­åœ°åŒº
  inferRegionFromContent(content) {
    // æ£€æŸ¥æ–‡ä»¶å†…å®¹ä¸­çš„åœ°å
    for (const [location, region] of Object.entries(this.locationToRegion)) {
      if (content.includes(location)) {
        return region;
      }
    }
    return null;
  }

  // ä¿®å¤å•ä¸ªæ–‡ä»¶çš„æ ‡ç­¾
  fixFileTags(filename) {
    try {
      const filePath = path.join(__dirname, '../src/data', filename);
      const content = fs.readFileSync(filePath, 'utf8');
      
      // æ¨æ–­æ­£ç¡®çš„æ ‡ç­¾
      let { correctRegion, correctMonth } = this.inferCorrectTags(filename);
      
      // å¦‚æœä»æ–‡ä»¶åæ— æ³•æ¨æ–­åœ°åŒºï¼Œå°è¯•ä»å†…å®¹æ¨æ–­
      if (!correctRegion) {
        correctRegion = this.inferRegionFromContent(content);
      }
      
      // å¦‚æœä»ç„¶æ— æ³•æ¨æ–­æœˆä»½ï¼Œå°è¯•ä»å†…å®¹ä¸­æŸ¥æ‰¾
      if (!correctMonth) {
        if (content.includes('7æœˆ') || content.includes('july') || content.includes('July')) {
          correctMonth = '7æœˆ';
        } else if (content.includes('8æœˆ') || content.includes('august') || content.includes('August')) {
          correctMonth = '8æœˆ';
        } else if (content.includes('9æœˆ') || content.includes('september') || content.includes('September')) {
          correctMonth = '9æœˆ';
        }
      }
      
      let newContent = content;
      let hasChanges = false;
      
      // æ£€æŸ¥æ˜¯å¦å­˜åœ¨tagså¯¹è±¡
      const tagsMatch = content.match(/tags:\s*{([^}]*)}/s);
      if (!tagsMatch) {
        // å¦‚æœæ²¡æœ‰tagså¯¹è±¡ï¼Œæ·»åŠ ä¸€ä¸ª
        const insertPosition = content.indexOf('export const');
        if (insertPosition !== -1 && correctRegion && correctMonth) {
          const tagsObject = `  tags: {
    timeTag: '${correctMonth}',
    regionTag: '${correctRegion}',
    typeTag: 'èŠ±ç«',
    layerTag: 'è¯¦ç»†ä»‹ç»'
  },
  `;
          newContent = content.slice(0, insertPosition) + tagsObject + content.slice(insertPosition);
          hasChanges = true;
        }
      } else {
        // ä¿®å¤ç°æœ‰çš„tagså¯¹è±¡
        const tagsContent = tagsMatch[1];
        let newTagsContent = tagsContent;
        
        // ä¿®å¤timeTag
        const timeTagMatch = tagsContent.match(/timeTag:\s*['"`]([^'"`]*?)['"`]/);
        if (!timeTagMatch && correctMonth) {
          newTagsContent = newTagsContent + `\n    timeTag: '${correctMonth}',`;
          hasChanges = true;
        } else if (timeTagMatch && correctMonth && timeTagMatch[1] !== correctMonth) {
          newTagsContent = newTagsContent.replace(
            /timeTag:\s*['"`][^'"`]*?['"`]/,
            `timeTag: '${correctMonth}'`
          );
          hasChanges = true;
        }
        
        // ä¿®å¤regionTag
        const regionTagMatch = tagsContent.match(/regionTag:\s*['"`]([^'"`]*?)['"`]/);
        if (!regionTagMatch && correctRegion) {
          newTagsContent = newTagsContent + `\n    regionTag: '${correctRegion}',`;
          hasChanges = true;
        } else if (regionTagMatch) {
          const currentRegion = regionTagMatch[1];
          // æ£€æŸ¥æ˜¯å¦éœ€è¦ä¿®å¤åœ°åŒºåç§°
          const fixedRegion = this.regionFixMapping[currentRegion] || (correctRegion || currentRegion);
          if (fixedRegion !== currentRegion) {
            newTagsContent = newTagsContent.replace(
              /regionTag:\s*['"`][^'"`]*?['"`]/,
              `regionTag: '${fixedRegion}'`
            );
            hasChanges = true;
          }
        }
        
        // ä¿®å¤typeTag
        const typeTagMatch = tagsContent.match(/typeTag:\s*['"`]([^'"`]*?)['"`]/);
        if (!typeTagMatch) {
          newTagsContent = newTagsContent + `\n    typeTag: 'èŠ±ç«',`;
          hasChanges = true;
        } else if (typeTagMatch[1] !== 'èŠ±ç«') {
          newTagsContent = newTagsContent.replace(
            /typeTag:\s*['"`][^'"`]*?['"`]/,
            `typeTag: 'èŠ±ç«'`
          );
          hasChanges = true;
        }
        
        // ä¿®å¤layerTag - å¼ºåˆ¶ä¿®å¤æ‰€æœ‰ä¸æ˜¯"è¯¦ç»†ä»‹ç»"çš„layerTag
        const layerTagMatch = tagsContent.match(/layerTag:\s*['"`]([^'"`]*?)['"`]/);
        if (!layerTagMatch) {
          newTagsContent = newTagsContent + `\n    layerTag: 'è¯¦ç»†ä»‹ç»'`;
          hasChanges = true;
        } else if (layerTagMatch[1] !== 'è¯¦ç»†ä»‹ç»') {
          newTagsContent = newTagsContent.replace(
            /layerTag:\s*['"`][^'"`]*?['"`]/,
            `layerTag: 'è¯¦ç»†ä»‹ç»'`
          );
          hasChanges = true;
        }
        
        if (hasChanges) {
          newContent = content.replace(
            /tags:\s*{([^}]*)}/s,
            `tags: {${newTagsContent}
  }`
          );
        }
      }
      
      if (hasChanges) {
        fs.writeFileSync(filePath, newContent, 'utf8');
        this.fixedFiles.push(`âœ… ${filename}: æ ‡ç­¾å·²ä¿®å¤`);
        this.stats.fixedFiles++;
        console.log(`âœ… ä¿®å¤ ${filename}`);
      } else {
        console.log(`â­ï¸ è·³è¿‡ ${filename} (æ— éœ€ä¿®å¤)`);
      }
      
    } catch (error) {
      this.errors.push(`âŒ ${filename}: ${error.message}`);
      this.stats.errorFiles++;
    }
  }

  // ä¿®å¤æ‰€æœ‰Level 5æ–‡ä»¶
  fixAllTags() {
    console.log('ğŸ” æŸ¥æ‰¾éœ€è¦ä¿®å¤çš„Level 5æ–‡ä»¶...\n');
    
    const dataDir = path.join(__dirname, '../src/data');
    const level5Files = fs.readdirSync(dataDir)
      .filter(f => f.includes('level5') && f.endsWith('.ts'))
      .sort();
    
    console.log(`ğŸ“Š å‘ç° ${level5Files.length} ä¸ªLevel 5æ–‡ä»¶\n`);
    
    level5Files.forEach(filename => {
      this.stats.totalFiles++;
      this.fixFileTags(filename);
    });
  }

  // ç”ŸæˆæŠ¥å‘Š
  generateReport() {
    console.log('\nğŸ“Š æ ‡ç­¾ä¿®å¤æŠ¥å‘Š:\n');
    console.log(`   æ€»æ–‡ä»¶æ•°: ${this.stats.totalFiles}`);
    console.log(`   ä¿®å¤æ–‡ä»¶æ•°: ${this.stats.fixedFiles}`);
    console.log(`   é”™è¯¯æ–‡ä»¶æ•°: ${this.stats.errorFiles}`);
    console.log(`   æˆåŠŸç‡: ${Math.round((this.stats.fixedFiles / this.stats.totalFiles) * 100)}%`);
    
    if (this.fixedFiles.length > 0) {
      console.log('\nâœ… ä¿®å¤çš„æ–‡ä»¶:');
      this.fixedFiles.forEach(fix => console.log(`   ${fix}`));
    }
    
    if (this.errors.length > 0) {
      console.log('\nâŒ ä¿®å¤å¤±è´¥çš„æ–‡ä»¶:');
      this.errors.forEach(error => console.log(`   ${error}`));
      return false;
    } else {
      console.log('\nğŸ‰ æ‰€æœ‰æ ‡ç­¾ä¿®å¤å®Œæˆï¼');
      return true;
    }
  }

  // è¿è¡Œå®Œæ•´ä¿®å¤
  runFix() {
    this.fixAllTags();
    return this.generateReport();
  }
}

// æ‰§è¡Œä¿®å¤
const fixer = new TagFixer();
const success = fixer.runFix();

process.exit(success ? 0 : 1); 