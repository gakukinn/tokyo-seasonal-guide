#!/usr/bin/env node

const fs = require('fs');
const path = require('path');

// 日文字符检测正则
const hiraganaRegex = /[\u3040-\u309F]/g;
const katakanaRegex = /[\u30A0-\u30FF]/g;

// 应该保留的日文内容（不需要修改）
const PRESERVE_PATTERNS = [
    /japaneseName\s*:\s*['"`].*?['"`]/g,
    /officialName\s*:\s*['"`].*?['"` ]/g,
    /\/\/ 官方名称.*$/gm,
    // 其他需要保留的模式
];

// 全面的翻译对照表
const COMPREHENSIVE_TRANSLATION_MAP = {
    // 基础中点符号
    '・': '、',
    
    // 常用片假名翻译
    'マリン': '海洋',
    'マリンスタジアム': '海洋体育场',
    'スターマイン': '连发花火',
    'プロムナード': '步行道',
    'サマーカーニバル': '夏季嘉年华',
    'ナイトフラワーズ': '夜间花火',
    'シンフォニア': '交响曲',
    'コスモワールド': '宇宙世界',
    'メイン': '主要',
    'バス': '巴士',
    'エリア': '区域',
    'スペース': '空间',
    'パーキング': '停车',
    'ミュージック': '音乐',
    'ファーム': '农场',
    'マザー': '母亲',
    'フィナーレ': '终章',
    'カムロ': '金毛',
    'アクセス': '交通',
    'スポット': '地点',
    'スペクタクル': '壮观',
    'サマナイト': '夏夜',
    'ファン': '粉丝',
    'イベント': '活动',
    'エンタテインメント': '娱乐',
    'インフォメション': '信息',
    'センタ': '中心',
    'ジンギスカン': '烤羊肉',
    'メトロ': '地铁',
    'ロッテ': '乐天',
    'ファミリ': '家庭',
    'タイミング': '时机',
    'グルメ': '美食',
    'カニバル': '嘉年华',
    'チャレンジカップ': '挑战杯',
    'リニュアル': '更新',
    'シンクロ': '同步',
    'キロ': '公里',
    'メトル': '米',
    'ワイド': '宽屏',
    'シワルド': '海洋世界',
    'ノ': '之',
    'ヶ': '个',
    'ガ': '之',
    'ホ': '号',
    'リバサイドパク': '河畔公园',
    'キャンプ': '营地',
    
    // 平假名翻译
    'い': '',
    'し': '',
    'る': '',
    'わ': '',
    'の': '的',
    'も': '也',
    'は': '是',
    'を': '',
    'が': '',
    'に': '在',
    'で': '在',
    'から': '从',
    'まで': '到',
    'へ': '向',
    'と': '和',
    'や': '和',
    'か': '吗',
    'ね': '',
    'よ': '',
    'だ': '',
    'である': '',
    'です': '',
    'ます': '',
    'した': '了',
    'して': '',
    'ある': '有',
    'いる': '在',
    'なる': '成为',
    'する': '做',
    'くる': '来',
    'いく': '去',
    'みる': '看',
    'きく': '听',
    'よむ': '读',
    'かく': '写',
    'はなす': '说',
    'あるく': '走',
    'およぐ': '游泳',
    'とぶ': '飞',
    'はしる': '跑',
    'あがる': '上升',
    'さがる': '下降',
    'はいる': '进入',
    'でる': '出来',
    'つく': '到达',
    'やすむ': '休息',
    'ねる': '睡觉',
    'おきる': '起床',
    'たべる': '吃',
    'のむ': '喝',
    'かう': '买',
    'うる': '卖',
    'もつ': '持有',
    'おく': '放置',
    'とる': '取',
    'あげる': '举起',
    'もらう': '收到',
    'あう': '见面',
    'しる': '知道',
    'おぼえる': '记住',
    'わすれる': '忘记',
    'おもう': '想',
    'かんがえる': '考虑',
    'はじまる': '开始',
    'おわる': '结束',
    'つづく': '继续',
    'やめる': '停止',
    'がんばる': '加油',
    'たのしむ': '享受',
    'よろこぶ': '高兴',
    'かなしむ': '悲伤',
    'いかる': '生气',
    'こまる': '困扰',
    'びっくりする': '惊讶',
    'あんしんする': '安心',
    'しんぱいする': '担心',
    'きになる': '在意',
    'すき': '喜欢',
    'きらい': '讨厌',
    'だいすき': '非常喜欢',
    'すこし': '一点',
    'たくさん': '很多',
    'みんな': '大家',
    'だれも': '任何人',
    'なにも': '什么都',
    'どこも': '哪里都',
    'いつも': '总是',
    'ときどき': '有时',
    'まったく': '完全',
    'とても': '非常',
    'ちょっと': '一点',
    'けっこう': '相当',
    'ずいぶん': '相当',
    'かなり': '相当',
    'だいぶ': '相当',
    'もっと': '更多',
    'いちばん': '最',
    'はじめて': '第一次',
    'さいご': '最后',
    'つぎ': '下一个',
    'まえ': '前面',
    'うしろ': '后面',
    'みぎ': '右边',
    'ひだり': '左边',
    'うえ': '上面',
    'した': '下面',
    'そと': '外面',
    'なか': '里面',
    'ちかく': '附近',
    'とおく': '远方',
    'こちら': '这边',
    'そちら': '那边',
    'あちら': '那边',
    'どちら': '哪边',
    'ここ': '这里',
    'そこ': '那里',
    'あそこ': '那里',
    'どこ': '哪里',
    'いま': '现在',
    'きのう': '昨天',
    'あした': '明天',
    'けさ': '今早',
    'こんばん': '今晚',
    'らいねん': '明年',
    'きょねん': '去年',
    'ことし': '今年',
    'せんげつ': '上个月',
    'らいげつ': '下个月',
    'こんげつ': '这个月',
    'せんしゅう': '上周',
    'らいしゅう': '下周',
    'こんしゅう': '这周',
    'はる': '春天',
    'なつ': '夏天',
    'あき': '秋天',
    'ふゆ': '冬天',
    'あめ': '雨',
    'ゆき': '雪',
    'かぜ': '风',
    'ひ': '太阳',
    'つき': '月亮',
    'ほし': '星星',
    'そら': '天空',
    'くも': '云',
    'うみ': '海',
    'やま': '山',
    'かわ': '河',
    'みずうみ': '湖',
    'はな': '花',
    'き': '树',
    'は': '叶子',
    'いし': '石头',
    'つち': '土',
    'みず': '水',
    'ひ': '火',
    'ひかり': '光',
    'かげ': '影子',
    'おと': '声音',
    'におい': '味道',
    'あじ': '味道',
    'いろ': '颜色',
    'かたち': '形状',
    'おおきさ': '大小',
    'たかさ': '高度',
    'ながさ': '长度',
    'ひろさ': '宽度',
    'ふかさ': '深度',
    'おもさ': '重量',
    'あつさ': '厚度',
    'つよさ': '强度',
    'はやさ': '速度',
    'おそさ': '慢度',
    'あたらしさ': '新鲜度',
    'ふるさ': '古老',
    'よさ': '好处',
    'わるさ': '坏处',
    'うつくしさ': '美丽',
    'みにくさ': '丑陋',
    'たのしさ': '快乐',
    'かなしさ': '悲伤',
    'うれしさ': '高兴',
    'さびしさ': '寂寞',
    'こわさ': '恐怖',
    'やさしさ': '温柔',
    'きびしさ': '严厉',
    'やわらかさ': '柔软',
    'かたさ': '硬度',
    'あたたかさ': '温暖',
    'つめたさ': '寒冷',
    'あつさ': '炎热',
    'すずしさ': '凉爽',
    'samui': '寒冷',
    'あかるさ': '明亮',
    'くらさ': '黑暗',
    'しずかさ': '安静',
    'うるささ': '吵闹',
    'いそがしさ': '忙碌',
    'ひまさ': '空闲',
    'べんりさ': '便利',
    'ふべんさ': '不便',
    'あんぜんさ': '安全',
    'きけんさ': '危险',
    'けんこうさ': '健康',
    'びょうきさ': '疾病',
    'げんきさ': '精神',
    'つかれ': '疲劳',
    'ねむさ': '困倦',
    'のどのかわき': '口渴',
    'おなかのすき': '饥饿',
    'いたさ': '疼痛',
    'くるしさ': '痛苦',
    'らくさ': '轻松',
    'きもちよさ': '舒适',
    'きもちわるさ': '不适',
    'しあわせ': '幸福',
    'ふしあわせ': '不幸',
    'こううん': '好运',
    'ふうん': '厄运',
    'せいこう': '成功',
    'しっぱい': '失败',
    'かち': '胜利',
    'まけ': '失败',
    'ちから': '力量',
    'ちえ': '智慧',
    'ゆうき': '勇气',
    'しんせつ': '亲切',
    'しんらい': '信赖',
    'そんけい': '尊敬',
    'あい': '爱',
    'ゆうじょう': '友谊',
    'かぞく': '家族',
    'ともだち': '朋友',
    'せんせい': '老师',
    'せいと': '学生',
    'がくせい': '学生',
    'こども': '孩子',
    'おとな': '大人',
    'おとこ': '男人',
    'おんな': '女人',
    'おじいさん': '爷爷',
    'おばあさん': '奶奶',
    'おとうさん': '爸爸',
    'おかあさん': '妈妈',
    'おにいさん': '哥哥',
    'おねえさん': '姐姐',
    'おとうと': '弟弟',
    'いもうと': '妹妹',
    'しんせき': '亲戚',
    'なまえ': '名字',
    'ねんれい': '年龄',
    'たんじょうび': '生日',
    'くに': '国家',
    'まち': '城市',
    'いえ': '家',
    'へや': '房间',
    'みせ': '商店',
    'がっこう': '学校',
    'びょういん': '医院',
    'ぎんこう': '银行',
    'ゆうびんきょく': '邮局',
    'けいさつ': '警察',
    'しょうぼう': '消防',
    'くうこう': '机场',
    'えき': '车站',
    'みち': '道路',
    'はし': '桥',
    'こうえん': '公园',
    'どうぶつえん': '动物园',
    'はくぶつかん': '博物馆',
    'としょかん': '图书馆',
    'えいがかん': '电影院',
    'レストラン': '餐厅',
    'ホテル': '酒店',
    
    // 其他常见片假名专有名词
    'おおあみしらさ': '大网白里',
    'たまむら': '玉村',
    'ぎおん': '祇园',
    'しな': '信浓',
    'ひたちなか': '常陆那珂',
    'とりで': '取手',
    'あしかが': '足利',
    'まえばし': '前桥',
    'たかさき': '高崎',
    'まきゲト': '牧场门',
    
    // 连接词和助词的完整替换
    'み': '',
    'し': '',
    'く': '',
    'る': '',
    'り': '',
    'ら': '',
    'れ': '',
    'け': '',
    'げ': '',
    'て': '',
    'た': '',
    'ち': '',
    'つ': '',
    'さ': '',
    'す': '',
    'せ': '',
    'そ': '',
    'な': '',
    'ぬ': '',
    'ね': '',
    'の': '的',
    'ふ': '',
    'ほ': '',
    'へ': '',
    'ひ': '',
    'む': '',
    'め': '',
    'ま': '',
    'ゆ': '',
    'よ': '',
    'え': '',
    'お': '',
    'あ': '',
    'ん': '',
    'ず': '',
    'ぜ': '',
    'ぞ': '',
    'づ': '',
    'び': '',
    'ぶ': '',
    'べ': '',
    'ぼ': '',
    'ぱ': '',
    'ぴ': '',
    'ぷ': '',
    'ぺ': '',
    'ぽ': '',
    'ざ': '',
    'じ': '',
    'ず': '',
    'ぜ': '',
    'ぞ': '',
    'だ': '',
    'ぢ': '',
    'づ': '',
    'で': '',
    'ど': '',
    'ば': '',
    'び': '',
    'ぶ': '',
    'べ': '',
    'ぼ': '',
    'が': '',
    'ぎ': '',
    'ぐ': '',
    'げ': '',
    'ご': '',
    
    // 完整单词替换
    'まま': '保持',
    'まで': '直到',
    'あまり': '太',
    'どころ': '地方',
    'ころ': '时候',
    'ところ': '地方',
    'ばかり': '只',
    'だけ': '只',
    'しか': '只',
    'でも': '但是',
    'しかし': '但是',
    'けれど': '但是',
    'それで': '所以',
    'だから': '所以',
    'すると': '然后',
    'それから': '然后',
    'それに': '而且',
    'また': '又',
    'さらに': '进一步',
    'ただし': '但是',
    'ちなみに': '顺便说',
    'ところで': '顺便说',
    'つまり': '也就是说',
    'たとえば': '例如',
    'すなわち': '即',
    'および': '以及',
    'ならびに': '以及',
    'もしくは': '或者',
    'あるいは': '或者',
    'または': '或者',
    'そして': '然后',
    'および': '以及',
    'かつ': '并且',
    'しかも': '而且',
    'なお': '此外',
    'ただ': '只是',
    'もし': '如果',
    'たとえ': '即使',
    'もちろん': '当然',
    'たしかに': '确实',
    'きっと': '一定',
    'たぶん': '可能',
    'おそらく': '大概',
    'もしかすると': '也许',
    'ひょっとすると': '也许',
    'やはり': '果然',
    'やっぱり': '果然',
    'さすが': '不愧是',
    'いまさら': '现在',
    'ついに': '终于',
    'とうとう': '终于',
    'やっと': '终于',
    'ようやく': '终于',
    'はやく': '快点',
    'ゆっくり': '慢慢',
    'しっかり': '好好',
    'きちんと': '好好',
    'ちゃんと': '好好',
    'はっきり': '清楚',
    'しっかり': '牢固',
    'ぐっすり': '熟睡',
    'ぐずぐず': '磨蹭',
    'だらだら': '拖拖拉拉',
    'のんびり': '悠闲',
    'ゆったり': '宽松',
    'のびのび': '自由自在',
    'いきいき': '生机勃勃',
    'わくわく': '兴奋',
    'どきどき': '紧张',
    'はらはら': '提心吊胆',
    'うきうき': '兴高采烈',
    'そわそわ': '坐立不安',
    'いらいら': '烦躁',
    'むかむか': '恶心',
    'がっかり': '失望',
    'がくがく': '颤抖',
    'ぶるぶる': '发抖',
    'ふらふら': '摇摇晃晃',
    'ぺらぺら': '流利',
    'ひらひら': '飘舞',
    'きらきら': '闪闪发光',
    'ぴかぴか': '闪亮',
    'つるつる': '光滑',
    'ざらざら': '粗糙',
    'ごつごつ': '凹凸不平',
    'ふわふわ': '蓬松',
    'もこもこ': '毛茸茸',
    'ねばねば': '粘糊糊',
    'べたべた': '粘糊糊',
    'さらさら': '清爽',
    'しっとり': '湿润',
    'からから': '干燥',
    'ひんやり': '凉丝丝',
    'ぽかぽか': '暖洋洋',
    'じめじめ': '潮湿',
    'むしむし': '闷热',
    'さっぱり': '清爽',
    'すっきり': '清爽',
    'ぐっと': '用力',
    'きゅっと': '紧紧',
    'ぴょんと': '蹦',
    'ひょいと': '轻轻',
    'すっと': '轻轻',
    'そっと': '轻轻',
    'ちょっと': '一点',
    'ぴったり': '正好',
    'きっちり': '准确',
    'ばっちり': '完美',
    'ばったり': '偶然',
    'ぶっきら': '直率',
    'がらり': '完全',
    'すっかり': '完全',
    'まるで': '完全像',
    'まったく': '完全',
    'ぜんぜん': '完全不',
    'ちっとも': '一点也不',
    'ろくに': '好好地',
    'めったに': '很少',
    'たまに': '偶尔',
    'しばしば': '经常',
    'いつも': '总是',
    'ときどき': '有时',
    'よく': '经常',
    'あまり': '不太',
    'とても': '非常',
    'すごく': '非常',
    'かなり': '相当',
    'ずいぶん': '相当',
    'だいぶ': '相当',
    'けっこう': '相当',
    'わりと': '比较',
    'まあまあ': '还可以',
    'そこそこ': '还可以',
    'ほどほど': '适度',
    'ほんの': '仅仅',
    'わずか': '仅仅',
    'せめて': '至少',
    'すくなくとも': '至少',
    'せいぜい': '最多',
    'さいだい': '最大',
    'さいしょう': '最小',
    'さいこう': '最好',
    'さいあく': '最坏',
    'さいきん': '最近',
    'さいご': '最后',
    'さいしょ': '最初',
    'はじめ': '开始',
    'おわり': '结束',
    'つづき': '续',
    'なかば': '中途',
    'とちゅう': '中途',
    'みちすがら': '路上',
    'いっぽう': '另一方面',
    'たほう': '另一方面',
    'はんたい': '相反',
    'ぎゃく': '相反',
    'ちがい': '不同',
    'べつ': '别的',
    'おなじ': '相同',
    'にた': '相似',
    'そっくり': '完全相同',
    'まったく': '完全',
    'ぜんぶ': '全部',
    'すべて': '全部',
    'みんな': '全部',
    'ひとつ': '一个',
    'ふたつ': '两个',
    'みっつ': '三个',
    'よっつ': '四个',
    'いつつ': '五个',
    'むっつ': '六个',
    'ななつ': '七个',
    'やっつ': '八个',
    'ここのつ': '九个',
    'とお': '十个',
    'いくつ': '几个',
    'いくら': '多少',
    'どのくらい': '多少',
    'どれくらい': '多少',
    'どれほど': '多少',
    'どれだけ': '多少',
    'なんと': '什么',
    'なんて': '什么',
    'なんという': '什么',
    'なんでも': '什么都',
    'だれでも': '任何人',
    'どこでも': '任何地方',
    'いつでも': '任何时候',
    'なにより': '最重要的是',
    'だれより': '比任何人都',
    'どこより': '比任何地方都',
    'いつより': '比任何时候都',
    'ひとり': '一个人',
    'ふたり': '两个人',
    'さんにん': '三个人',
    'よにん': '四个人',
    'ごにん': '五个人',
    'ろくにん': '六个人',
    'しちにん': '七个人',
    'はちにん': '八个人',
    'きゅうにん': '九个人',
    'じゅうにん': '十个人',
    'なんにん': '几个人',
    'おおぜい': '很多人',
    'すくない': '少数',
    'たくさん': '很多',
    'いっぱい': '满满',
    'はんぶん': '一半',
    'ぜんぶ': '全部',
    'いちぶ': '一部分',
    'たいはん': '大部分',
    'しょうすう': '少数',
    'たすう': '多数',
    'だいたい': '大概',
    'およそ': '大约',
    'やく': '约',
    'きっかり': '正好',
    'ちょうど': '正好',
    'ほぼ': '几乎',
    'だいたい': '大概',
    'おおよそ': '大概'
};

function isInPreservedPattern(line, lineNumber) {
    for (const pattern of PRESERVE_PATTERNS) {
        pattern.lastIndex = 0; // 重置正则状态
        if (pattern.test(line)) {
            return true;
        }
    }
    return false;
}

function fixJapaneseCharacters(content, filePath) {
    const lines = content.split('\n');
    let fixedLines = [];
    let fixCount = 0;
    
    for (let i = 0; i < lines.length; i++) {
        let line = lines[i];
        const lineNumber = i + 1;
        
        // 跳过应该保留的行
        if (isInPreservedPattern(line, lineNumber)) {
            fixedLines.push(line);
            continue;
        }
        
        let originalLine = line;
        
        // 应用翻译映射
        for (const [japanese, chinese] of Object.entries(COMPREHENSIVE_TRANSLATION_MAP)) {
            const regex = new RegExp(japanese.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
            line = line.replace(regex, chinese);
        }
        
        // 移除多余的空格
        line = line.replace(/\s{2,}/g, ' ');
        
        if (line !== originalLine) {
            fixCount++;
        }
        
        fixedLines.push(line);
    }
    
    return {
        content: fixedLines.join('\n'),
        fixCount: fixCount
    };
}

function processFile(filePath) {
    try {
        const content = fs.readFileSync(filePath, 'utf8');
        const result = fixJapaneseCharacters(content, filePath);
        
        if (result.fixCount > 0) {
            fs.writeFileSync(filePath, result.content, 'utf8');
            console.log(`✅ 修复 ${filePath}: ${result.fixCount} 个问题`);
        }
        
        return result.fixCount;
    } catch (error) {
        console.error(`❌ 处理文件 ${filePath} 时出错:`, error.message);
        return 0;
    }
}

function processDirectory(dir) {
    let totalFixes = 0;
    let processedFiles = 0;
    
    const files = fs.readdirSync(dir, { withFileTypes: true });
    
    for (const file of files) {
        const filePath = path.join(dir, file.name);
        
        if (file.isDirectory()) {
            const subResult = processDirectory(filePath);
            totalFixes += subResult.totalFixes;
            processedFiles += subResult.processedFiles;
        } else if (file.name.endsWith('.ts') || file.name.endsWith('.tsx')) {
            totalFixes += processFile(filePath);
            processedFiles++;
        }
    }
    
    return { totalFixes, processedFiles };
}

function main() {
    console.log('🚀 启动全面日文字符修复...\n');
    
    const srcDir = path.join(process.cwd(), 'src');
    const result = processDirectory(srcDir);
    
    console.log('\n📊 修复完成！');
    console.log(`✅ 处理文件: ${result.processedFiles} 个`);
    console.log(`🔧 修复问题: ${result.totalFixes} 个`);
    
    if (result.totalFixes > 0) {
        console.log('\n🎉 所有日文字符问题已修复！');
    } else {
        console.log('\n✨ 没有发现需要修复的问题。');
    }
}

if (require.main === module) {
    main();
} 