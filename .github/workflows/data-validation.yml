name: æ•°æ®éªŒè¯å’Œè´¨é‡æ£€æŸ¥

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]
    paths:
      - 'src/data/**'
      - 'scripts/**'

jobs:
  data-validation:
    name: æ•°æ®å®Œæ•´æ€§éªŒè¯
    runs-on: ubuntu-latest
    
    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v4
      
    - name: è®¾ç½®Node.jsçŽ¯å¢ƒ
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: å®‰è£…ä¾èµ–
      run: npm ci
      
    - name: éªŒè¯å›¾ç‰‡èµ„æº
      run: npm run validate-images
      
    - name: éªŒè¯é“¾æŽ¥å®Œæ•´æ€§
      run: npm run validate-links
      
    - name: éªŒè¯æ—¥æ–‡æ ‡é¢˜
      run: npm run validate-japanese
      
    - name: ä»£ç æ ¼å¼æ£€æŸ¥
      run: npm run lint
      
    - name: ç”ŸæˆéªŒè¯æŠ¥å‘Š
      if: failure()
      run: |
        echo "## æ•°æ®éªŒè¯å¤±è´¥æŠ¥å‘Š" >> $GITHUB_STEP_SUMMARY
        echo "è¯·æ£€æŸ¥ä»¥ä¸‹é¡¹ç›®ï¼š" >> $GITHUB_STEP_SUMMARY
        echo "- å›¾ç‰‡èµ„æºæ˜¯å¦å­˜åœ¨" >> $GITHUB_STEP_SUMMARY
        echo "- é“¾æŽ¥æ˜¯å¦å®Œæ•´" >> $GITHUB_STEP_SUMMARY
        echo "- æ—¥æ–‡æ ‡é¢˜æ˜¯å¦ç¼ºå¤±" >> $GITHUB_STEP_SUMMARY
        echo "- ä»£ç æ ¼å¼æ˜¯å¦è§„èŒƒ" >> $GITHUB_STEP_SUMMARY

  build-test:
    name: æž„å»ºæµ‹è¯•
    runs-on: ubuntu-latest
    needs: data-validation
    
    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v4
      
    - name: è®¾ç½®Node.jsçŽ¯å¢ƒ
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: å®‰è£…ä¾èµ–
      run: npm ci
      
    - name: æ‰§è¡Œæž„å»º
      run: npm run build
      
    - name: ç”Ÿæˆæž„å»ºæŠ¥å‘Š
      run: |
        echo "## æž„å»ºæˆåŠŸæŠ¥å‘Š" >> $GITHUB_STEP_SUMMARY
        echo "âœ… æ‰€æœ‰æ•°æ®éªŒè¯é€šè¿‡" >> $GITHUB_STEP_SUMMARY
        echo "âœ… é¡¹ç›®æž„å»ºæˆåŠŸ" >> $GITHUB_STEP_SUMMARY
        echo "ðŸš€ å‡†å¤‡éƒ¨ç½²" >> $GITHUB_STEP_SUMMARY 